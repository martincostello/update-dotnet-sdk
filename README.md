# Update .NET SDK

[![Build status](https://github.com/martincostello/update-dotnet-sdk/workflows/build/badge.svg?branch=main&event=push)](https://github.com/martincostello/update-dotnet-sdk/actions?query=workflow%3Abuild+branch%3Amain+event%3Apush)
[![codecov](https://codecov.io/gh/martincostello/update-dotnet-sdk/branch/main/graph/badge.svg)](https://codecov.io/gh/martincostello/update-dotnet-sdk)
[![OpenSSF Scorecard](https://api.securityscorecards.dev/projects/github.com/martincostello/update-dotnet-sdk/badge)](https://api.securityscorecards.dev/projects/github.com/martincostello/update-dotnet-sdk)

This action updates the .NET SDK version specified by a `global.json` file stored in a GitHub repository.

An example Pull Request created by the action can be found [here](https://github.com/martincostello/update-dotnet-sdk/pull/10).

## Example Usage

```yml
steps:
- uses: actions/checkout@v3
- uses: martincostello/update-dotnet-sdk@v2
  with:
    repo-token: ${{ secrets.GITHUB_TOKEN }}
```

### Example Workflow

Below is an example of a full GitHub Actions workflow to automate .NET SDK updates.

```yml
name: update-dotnet-sdk

on:

  # Run at 2100 UTC on Tuesday every week to pick up any updates from
  # Patch Tuesday which occur on the second Tuesday of the month (PST).
  schedule:
    - cron:  '00 21 * * TUE'

  # Support running the workflow manually on-demand.
  workflow_dispatch:

jobs:
  update-dotnet-sdk:
    name: Update .NET SDK
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: martincostello/update-dotnet-sdk@v2
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
```

### Advanced Example Workflow

Below is an example of a full GitHub Actions workflow to automate .NET SDK updates
that will also use the [dotnet-outdated](https://github.com/dotnet-outdated/dotnet-outdated)
.NET Global Tool to update any NuGet packages for the current .NET SDK release channel
that are available from NuGet.org if the .NET SDK is updated.

This action leverages a [GitHub reusable workflow](https://docs.github.com/en/actions/using-workflows/reusing-workflows)
that is included in this repository, which can be found [here](https://github.com/martincostello/update-dotnet-sdk/blob/main/.github/workflows/update-dotnet-sdk.yml).

```yaml
name: update-dotnet-sdk

on:

  # Scheduled trigger to check for .NET SDK updates at 2000 UTC every
  # Tuesday so that a run will coincide with monthly Update Tuesday releases
  # for security and non-security improvements to the .NET SDK and runtime.
  schedule:
    - cron:  '00 20 * * TUE'

  # Manual trigger to update the .NET SDK on-demand.
  workflow_dispatch:

# Set the minumum permissions for GITHUB_TOKEN.
# Use the commented-out additional permission if using GITHUB_TOKEN.
permissions:
  contents: read
  #pull-requests: read

jobs:

  update-sdk:

    uses: martincostello/update-dotnet-sdk/.github/workflows/update-dotnet-sdk.yml@main

    # Set minimum required write permissions if using GITHUB_TOKEN.
    #permissions:
    #  contents: write
    #  pull-requests: write

    # Using a real user/email is recommended instead of using GITHUB_TOKEN, otherwise pull
    # requests opened by this workflow, and commits pushed, will not queue your CI status checks.
    # Similarly, the approve-and-merge workflow will also not run if GITHUB_TOKEN is used.
    # See https://docs.github.com/en/actions/using-workflows/triggering-a-workflow#triggering-a-workflow-from-a-workflow
    # The Git commit user name and email are set as variables in the organization or repository settings.
    # See https://docs.github.com/en/actions/learn-github-actions/variables
    with:
      labels: "dependencies,.NET"
      user-email: ${{ vars.GIT_COMMIT_USER_EMAIL }}
      user-name: ${{ vars.GIT_COMMIT_USER_NAME }}
    secrets:
      repo-token: ${{ secrets.ACCESS_TOKEN }}
```

## Inputs

## Required

| **Name** | **Description** |
|:--|:--|
| `repo-token` | The GitHub access token to use to create a Pull Request for any SDK update to the repository. |

### Optional

| **Name** | **Description** | **Default** |
|:--|:--|:--|
| `branch-name` | The optional Git branch name to use. | - |
| `channel` | The optional .NET release channel to download the SDK for (3.1, 6.0, etc.). | The channel derived from the current SDK version. |
| `commit-message` | The optional Git commit message to use. | - |
| `global-json-file` | The optional path to the global.json file to update the SDK for. | `./global.json` |
| `labels` | The optional comma-separated label(s) to apply to Pull Requests generated by the action. | - |
| `user-email` | The optional email address to use for the Git commit. | `github-actions[bot]@users.noreply.github.com` |
| `user-name` | The optional user name to use for the Git commit. | `github-actions[bot]` |
| `dry-run` | If true, the action will not push changes to GitHub. | `false` |

## Outputs

| **Name** | **Description** |
|:--|:--|
| `pull-request-number` | The number of the Pull Request created by the action if the .NET SDK is updated. |
| `pull-request-html-url` | The HTML URL of the Pull Request created by the action if the .NET SDK is updated. |
| `sdk-updated` | Whether the .NET SDK was updated by the action. |
| `sdk-version` | The latest version of the .NET SDK for the specified channel when the action completed. |

## Feedback

Any feedback or issues can be added to the issues for this project in [GitHub](https://github.com/martincostello/update-dotnet-sdk/issues).

## Repository

The repository is hosted in [GitHub](https://github.com/martincostello/update-dotnet-sdk): <https://github.com/martincostello/update-dotnet-sdk.git>

## License

This project is licensed under the [Apache 2.0](https://www.apache.org/licenses/LICENSE-2.0.txt) license.
